# ステップ 4: カメラと入力システム

このステップでは、ユーザー入力とカメラの移動・回転を処理するための **Input Manager（入力管理クラス）** と **Camera（カメラクラス）** を実装します。  
これらはそれぞれ独立したヘッダー／CPP ファイルとして作成され、メインのゲームループに統合されています。

---

## 🎮 Input Manager（入力管理）

### **入力処理の一元化**
`InputManager` クラスは SDL の生イベントを収集して処理します。  
入力処理がメインループから切り離され、整理された構造になります。

### **SDL イベント処理**
- メインループの `SDL_PollEvent` 内で、キーボードおよびマウスイベントは `ProcessEvent` 関数に渡されます。  
- SDL のキーコードは `MapAndSetKey` によりエンジン内部の状態へマッピングされます。

### **キー状態の管理**
- `IsKeyDown` によって、キーが押され続けているかを判定できます。  
- 移動用の **W, A, S, D** キーを継続的に監視し、スムーズな移動を実現します。

### **マウスルック**
- フレームごとにマウス移動量（Δx, Δy）を計算。  
- これらの値を用いてカメラの **yaw（ヨー）** と **pitch（ピッチ）** を更新し、自由視点のマウスルックを実装します。

---

## 📷 Camera クラス

### **カメラの状態管理**
`Camera` クラスは DirectXMath ベクトルを用いてカメラの状態を保持します：

- `XMFLOAT3 m_position`  
- `XMFLOAT3 m_forward`, `m_up`, `m_right`  
- `float m_pitch`, `float m_yaw`

位置と回転は `UpdateFromInput` によって更新され、方向ベクトルは `RecomputeBasis` で再計算されます。

### **ビュー行列の計算**
`GetViewMatrix` は以下を元にビュー行列を構築します：
- カメラ位置  
- ターゲット／前方ベクトル  
- 上方向ベクトル  

### **プロジェクション行列の計算**
`GetProjectionMatrix` は以下を使用して投影行列を作成します：
- ビューポートの幅／高さ  
- 視野角（FOV）  
- ニア／ファークリップ  

行列の構築には `XMMatrixPerspectiveFovLH` を使用します。

---

## 🔄 更新と同期

### **メインループとの統合**
Input Manager と Camera はゲームループの **Update** フェーズで更新されます。

### **行列の更新**
**Render** フェーズでは、Camera から取得した **View × Projection 行列** をレンダリングパイプラインの Constant Buffer に送信します。

